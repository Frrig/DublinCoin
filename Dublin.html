<!DOCTYPE html>
<html>
<head>
    <title>Dublin Coin Clicker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #clicker {
            width: 200px;
            height: 200px;
            background-image: url('SWSEF.png');
            background-size: cover;
            margin: 20px auto;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Dublin Coin Clicker</h1>
    <p>Баланс: <span id="balance">0</span> Dublin Coins</p>
    <p>Уровень: <span id="level">1</span></p>
    <div id="clicker"></div>
    <p>Улучшение добычи: <span id="upgrade-cost">2</span> Dublin Coins</p>
    <button id="upgrade-button">Улучшить</button>

    <script>
        const userId = new URLSearchParams(window.location.search).get('user_id');
        let balance = 0;
        let miningLevel = 1;
        let level = 1;

        // Получение данных пользователя из базы данных
        fetch(`/get_user?user_id=${userId}`)
            .then(response => response.json())
            .then(data => {
                balance = data.balance;
                miningLevel = data.mining_level;
                level = data.level;
                updateUI();
            });

        // Обновление интерфейса
        function updateUI() {
            document.getElementById('balance').textContent = balance;
            document.getElementById('level').textContent = level;
            document.getElementById('upgrade-cost').textContent = 2 ** (miningLevel - 1);
        }

        // Обработчик клика по кликеру
        document.getElementById('clicker').addEventListener('click', () => {
            balance += miningLevel;
            updateUI();
            saveUser();
        });

        // Обработчик клика по кнопке улучшения
        document.getElementById('upgrade-button').addEventListener('click', () => {
            const upgradeCost = 2 ** (miningLevel - 1);
            if (balance >= upgradeCost) {
                balance -= upgradeCost;
                miningLevel++;
                updateUI();
                saveUser();
            }
        });

        // Сохранение данных пользователя в базе данных
        function saveUser() {
            fetch('/save_user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    balance: balance,
                    mining_level: miningLevel,
                    level: level
                })
            });
        }
    </script>
</body>
</html>
